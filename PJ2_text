{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "view-in-github",
        "colab_type": "text"
      },
      "source": [
        "<a href=\"https://colab.research.google.com/github/jinikim1107/wanted-auto-mailer/blob/main/PJ2_text\" target=\"_parent\"><img src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/></a>"
      ]
    },
    {
      "cell_type": "markdown",
      "id": "ed3c7fff",
      "metadata": {
        "id": "ed3c7fff"
      },
      "source": [
        "# Project 2: 텍스트 분류 — ML 전체 흐름 체득"
      ]
    },
    {
      "cell_type": "code",
      "source": [],
      "metadata": {
        "id": "_MRG6E3H9Ddk"
      },
      "id": "_MRG6E3H9Ddk",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "id": "3343f40d",
      "metadata": {
        "id": "3343f40d"
      },
      "source": [
        "## 0. 준비\n",
        "- Colab 런타임: CPU로 충분\n",
        "- 좌측 파일탐색기에서 `data/texts.csv` 존재 확인"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "2d5f55d8",
      "metadata": {
        "id": "2d5f55d8"
      },
      "outputs": [],
      "source": [
        "\n",
        "# 라이브러리 설치 (Colab에서 최초 1번)\n",
        "# !pip install scikit-learn pandas matplotlib gradio joblib seaborn\n"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "b5e8dc9f",
      "metadata": {
        "id": "b5e8dc9f"
      },
      "outputs": [],
      "source": [
        "\n",
        "import pandas as pd, matplotlib.pyplot as plt\n",
        "from sklearn.model_selection import train_test_split\n",
        "from sklearn.feature_extraction.text import TfidfVectorizer\n",
        "from sklearn.linear_model import LogisticRegression\n",
        "from sklearn.pipeline import Pipeline\n",
        "from sklearn.metrics import classification_report, confusion_matrix\n",
        "import seaborn as sns\n",
        "import joblib, os\n",
        "\n",
        "df_path = \"/content/data/texts.csv\" if os.path.exists(\"/content/data/texts.csv\") else \"/mnt/data/ai_planner_3day_bootcamp/data/texts.csv\"\n",
        "df = pd.read_csv(df_path)\n",
        "df.head()\n"
      ]
    },
    {
      "cell_type": "markdown",
      "id": "1dd9c51f",
      "metadata": {
        "id": "1dd9c51f"
      },
      "source": [
        "## 1. 간단 EDA"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "e0179b26",
      "metadata": {
        "id": "e0179b26"
      },
      "outputs": [],
      "source": [
        "\n",
        "df['label'].value_counts().plot(kind='bar'); plt.title(\"라벨 분포\"); plt.show()\n",
        "df['len'] = df['text'].str.len()\n",
        "df['len'].hist(); plt.title(\"문장 길이(문자수)\"); plt.show()\n",
        "df[['text','label']].head(10)\n"
      ]
    },
    {
      "cell_type": "markdown",
      "id": "289aa73d",
      "metadata": {
        "id": "289aa73d"
      },
      "source": [
        "## 2. 학습/검증 분리 & 파이프라인"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "826e52c8",
      "metadata": {
        "id": "826e52c8"
      },
      "outputs": [],
      "source": [
        "\n",
        "X_train, X_test, y_train, y_test = train_test_split(\n",
        "    df['text'], df['label'], test_size=0.2, stratify=df['label'], random_state=42\n",
        ")\n",
        "\n",
        "pipe = Pipeline([\n",
        "    (\"tfidf\", TfidfVectorizer(max_features=20000, ngram_range=(1,2))),\n",
        "    (\"clf\", LogisticRegression(max_iter=1000))\n",
        "])\n",
        "pipe.fit(X_train, y_train)\n",
        "print(classification_report(y_test, pipe.predict(X_test)))\n"
      ]
    },
    {
      "cell_type": "markdown",
      "id": "b9a30b56",
      "metadata": {
        "id": "b9a30b56"
      },
      "source": [
        "## 3. 에러 케이스 보기"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "cf08285c",
      "metadata": {
        "id": "cf08285c"
      },
      "outputs": [],
      "source": [
        "\n",
        "y_pred = pipe.predict(X_test)\n",
        "cm = confusion_matrix(y_test, y_pred, labels=pipe.classes_)\n",
        "import numpy as np\n",
        "fig, ax = plt.subplots()\n",
        "im = ax.imshow(cm)\n",
        "ax.set_xticks(np.arange(len(pipe.classes_))); ax.set_xticklabels(pipe.classes_)\n",
        "ax.set_yticks(np.arange(len(pipe.classes_))); ax.set_yticklabels(pipe.classes_)\n",
        "plt.title(\"혼동행렬\"); plt.xlabel(\"Pred\"); plt.ylabel(\"True\"); plt.colorbar(im); plt.show()\n",
        "\n",
        "errs = X_test[y_test != y_pred][:10]\n",
        "errs.to_frame().assign(true=y_test[y_test!=y_pred], pred=y_pred[y_test!=y_pred]).head(10)\n"
      ]
    },
    {
      "cell_type": "markdown",
      "id": "89246daf",
      "metadata": {
        "id": "89246daf"
      },
      "source": [
        "## 4. 모델 저장"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "0a410674",
      "metadata": {
        "id": "0a410674"
      },
      "outputs": [],
      "source": [
        "\n",
        "os.makedirs(\"artifacts\", exist_ok=True)\n",
        "import joblib\n",
        "joblib.dump(pipe, \"artifacts/text_model.pkl\")\n",
        "print(\"saved to artifacts/text_model.pkl\")\n"
      ]
    },
    {
      "cell_type": "markdown",
      "id": "3e8d9356",
      "metadata": {
        "id": "3e8d9356"
      },
      "source": [
        "## 5. (선택) Gradio 데모"
      ]
    },
    {
      "cell_type": "code",
      "execution_count": null,
      "id": "ab6ef15c",
      "metadata": {
        "id": "ab6ef15c"
      },
      "outputs": [],
      "source": [
        "\n",
        "import gradio as gr, joblib\n",
        "clf = joblib.load(\"artifacts/text_model.pkl\")\n",
        "def predict(text):\n",
        "    proba = clf.predict_proba([text])[0]\n",
        "    label = clf.classes_[proba.argmax()]\n",
        "    return {str(c): float(p) for c,p in zip(clf.classes_, proba)}, f\"예측: {label}\"\n",
        "demo = gr.Interface(fn=predict, inputs=gr.Textbox(lines=3, label=\"문장 입력\"), outputs=[gr.Label(label=\"확률\"), gr.Textbox(label=\"예측\")], title=\"나만의 감성 분류기\")\n",
        "# demo.launch(share=True)  # Colab에서 실행 시 주석 제거\n"
      ]
    }
  ],
  "metadata": {
    "colab": {
      "provenance": [],
      "include_colab_link": true
    },
    "language_info": {
      "name": "python"
    },
    "kernelspec": {
      "name": "python3",
      "display_name": "Python 3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}